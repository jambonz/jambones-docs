<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="../img/favicon.ico">

    
    <title>Installing - jambonz</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">

    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="..">jambonz</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../jambonz/">jambonz Call Control JSON</a>
</li>

                        
                            
<li >
    <a href="../rest/">REST API</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../data/">Data architecture</a>
                    </li>
                
                
                
                    <li >
                        <a href="../register-hook/">Authenticating sip clients</a>
                    </li>
                
                
                
                    <li >
                        <a href="../tutorials/">Tutorials</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Installing</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../tutorials/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li class="disabled">
                        <a rel="next" >
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#installing-jambonz">Installing jambonz</a></li>
            <li class="second-level"><a href="#aws">AWS</a></li>
                
            <li class="second-level"><a href="#otherwise">Otherwise..</a></li>
                
                <li class="third-level"><a href="#a-provision-servers">A. Provision servers</a></li>
                <li class="third-level"><a href="#b-use-ansible-to-install-base-software">B. Use ansible to install base software</a></li>
                <li class="third-level"><a href="#c-create-mysql-database">C. Create mysql database</a></li>
                <li class="third-level"><a href="#d-create-redis-server">D. Create redis server</a></li>
                <li class="third-level"><a href="#e-configure-sbc">E. Configure SBC</a></li>
                <li class="third-level"><a href="#f-configure-feature-server">F. Configure Feature Server</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="installing-jambonz">Installing jambonz</h1>
<h2 id="aws">AWS</h2>
<p>The quickest way to deploy jambonz currently is on AWS using the provided <a href="https://github.com/jambonz/jambonz-infrastructure">terraform scripts</a>.  Review <a href="/tutorials/#quickstart-deploying-jambonz-on-aws-in-10-minutes-or-less">this quickstart video</a> for details.</p>
<h2 id="otherwise">Otherwise..</h2>
<p>If you are using a different hosted provider, or have your own hardware, there is a little more elbow grease required!  Follow the instructions below to create a jambonz deployment consisting of one SBC and one Feature Server.  You will also be provisioning a mysql server and a redis server.</p>
<h3 id="a-provision-servers">A. Provision servers</h3>
<p>You'll need two servers -- one will be the public-facing SBC, while the other will be the feature server.  The SBC must have a public address; the Feature Server does not necessarily need a public address, but of course will need connectivity to the SBC, the mysql database, and the redis server.  If desired, you can install mysql and redis on the SBC server, but as long as they are reachable from both the SBC and the Feature Server you'll be fine.  We will be using ansible to build up the servers, which means from your laptop you need ssh connectivity to both the SBC and the Feature Server.</p>
<p>The base software distribution for both the SBC and the Feature Server should be Debian 9.  A vanilla install that includes sudo and python is all that is needed (python is used by <a href="https://www.ansible.com/">ansible</a>, which we will be using to build up the servers in the next step).</p>
<h3 id="b-use-ansible-to-install-base-software">B. Use ansible to install base software</h3>
<p>If you don't have ansible installed on your laptop, install it now <a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html">following these instructions</a>.</p>
<p>Check out the following github repos to your laptop:</p>
<p><a href="https://github.com/davehorton/ansible-role-drachtio">ansible-role-drachtio</a></p>
<p><a href="https://github.com/davehorton/ansible-role-fsmrf">ansible-role-fsmrf</a></p>
<p><a href="https://github.com/davehorton/ansible-role-nodejs">ansible-role-nodejs</a></p>
<p><a href="https://github.com/davehorton/ansible-role-rtpengine">ansible-role-rtpengine</a></p>
<p>For the SBC, create an ansible playbook that looks like this, and run it:</p>
<pre><code class="yaml">---
- hosts: all
  become: yes
  vars: 
    drachtioBranch: develop
    rtp_engine_version: mr8.5
  vars_prompt:
    - name: &quot;cloud_provider&quot;
      prompt: &quot;Cloud provider: aws, gcp, azure, digital_ocean&quot;
      default: none
      private: no
  roles:
    - ansible-role-drachtio
    - ansible-role-nodejs
    - ansible-role-rtpengine
</code></pre>

<p>and for the Feature Server, create an ansible playbook that looks like this, and run it:</p>
<pre><code class="yaml">---
- hosts: all
  become: yes
  vars:
    drachtioBranch: develop
    build_with_grpc: true
  vars_prompt:
    - name: &quot;cloud_provider&quot;
      prompt: &quot;Cloud provider: aws, gcp, azure, digital_ocean&quot;
      default: none
      private: no
  roles:
    - ansible-role-drachtio
    - ansible-role-nodejs
    - ansible-role-fsmrf
</code></pre>

<h3 id="c-create-mysql-database">C. Create mysql database</h3>
<p>You need to install a mysql database server.  Example instructions for installing mysql are provided <a href="https://dev.mysql.com/downloads/">here</a>.</p>
<p>Once the mysql server is installed, create a new database named 'jambones' with an associated username 'admin' and a password of your choice.  For the remainder of these instructions, we'll assume a password of 'JambonzR0ck$' was assigned, but you may create a password of your own choosing.</p>
<p>Once the database and user has been created, then create <a href="https://github.com/jambonz/jambonz-api-server/blob/master/db/jambones-sql.sql">this schema</a>.</p>
<p>Once the database schema has been created, run <a href="https://github.com/jambonz/jambonz-api-server/blob/master/db/create-admin-token.sql">this database script</a> as well as <a href="https://github.com/jambonz/jambonz-api-server/blob/master/db/create-default-account.sql">this database script</a> to seed the database with initial data.</p>
<h3 id="d-create-redis-server">D. Create redis server</h3>
<p>Install redis somewhere in your network by following <a href="https://redis.io/topics/quickstart">these instructions</a> and save the redis hostname that you will use to connect to it.</p>
<h3 id="e-configure-sbc">E. Configure SBC</h3>
<p>Your SBC should have both a public IP and a private IP.  The public IP needs to be reachable from the internet, while the private IP should be on the internal subnet, and thus reachable by the Feature Server.</p>
<blockquote>
<p>In the examples below, we assume that the public IP is 190.144.12.220 and the private IP is 192.168.3.11.  Your IPs will be different of course, so substitute the correct IPs in the changes below.</p>
</blockquote>
<h4 id="drachtio-configuration">drachtio configuration</h4>
<p>In <code>/etc/systemd/system/drachtio.service</code> change this line:</p>
<pre><code>ExecStart=/usr/local/bin/drachtio --daemon
</code></pre>

<p>to this:</p>
<pre><code>ExecStart=/usr/local/bin/drachtio --daemon \
--contact sip:192.168.3.11;transport=udp --external-ip 190.144.12.220 \
--contact sip:192.168.3.11;transport=tcp \
--address 0.0.0.0 --port 9022
</code></pre>

<p><strong>or</strong>, if you plan on enabling Microsoft Teams routing, to this:</p>
<pre><code>ExecStart=/usr/local/bin/drachtio --daemon \
--contact sip:192.168.3.11;transport=udp --external-ip 190.144.12.220 \
--contact sips:192.168.3.11:5061;transport=tls --external-ip 190.144.12.220 \
--contact sip:192.168.3.11;transport=tcp \
--address 0.0.0.0 --port 9022
</code></pre>

<p>Then, reload and restart the drachtio server</p>
<pre><code>systemctl daemon-reload
systemctl restart drachtio
</code></pre>

<p>After doing that, check <code>/var/log/drachtio/drachtio.log</code> to verify that the drachtio server started properly and is listening on the specified IPs and ports.</p>
<h4 id="rtpengine-configuration">rtpengine configuration</h4>
<p>In <code>/etc/systemd/system/drachtio.service</code> change this line:</p>
<pre><code>ExecStart=/usr/local/bin/rtpengine --interface 192.168.3.11!192.168.3.11 \
</code></pre>

<p>to this:</p>
<pre><code>ExecStart=/usr/local/bin/rtpengine \
--interface private/192.168.3.11 \
--interface public/192.168.3.11!190.144.12.220 \
</code></pre>

<p>Then, reload and restart rtpengine</p>
<pre><code>systemctl daemon-reload
systemctl restart rtpengine
</code></pre>

<p>After doing that, run <code>systemctl status rtpengine</code> to verify that rtpengine is running with the defined interfaces.</p>
<h3 id="f-configure-feature-server">F. Configure Feature Server</h3></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
        </p>

        
        
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    
    <script>var base_url = ".."</script>
    
    <script src="../js/base.js"></script>
    <script src="../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
